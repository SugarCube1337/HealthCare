<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacancies</title>
    <link rel="stylesheet" th:href="@{/css/vacancies.css}">
</head>
<body>
<div class="vacancies-container">
    <button class="back-button" onclick="goBack()">Back</button>
    <h1>Available Vacancies</h1>
    <div class="add-vacancy-container">
        <button th:if="${staffMember.position == 'Admin'}"
                onclick="window.location.href='/vacancies/register_vacancy'"
                class="register-button">
            Add New Vacancy
        </button>
    </div>
    <ul>
        <li th:each="vacancy : ${vacancies}">
            <div class="vacancy">
                <h2 th:text="${vacancy.position}"></h2>
                <p><strong>Requirements:</strong> <span th:text="${vacancy.requirements}"></span></p>
                <p><strong>Opening Date:</strong> <span th:text="${vacancy.openingDate}"></span></p>
                <p><strong>Salary:</strong> <span th:text="${vacancy.minSalary}"></span></p>
                <p><strong>Status:</strong> <span th:text="${vacancy.status}"></span></p>
                <p><strong>Employment Type:</strong> <span th:text="${vacancy.typeOfEmployment}"></span></p>

                <!-- Доступно только для определённых позиций -->
                <button th:if="${staffMember.position != 'admin'}"
                        th:onclick="'deleteVacancy(' + ${vacancy.id} + ')'"
                        class="delete-button">
                    Delete
                </button>


                <button th:if="${staffMember.position == 'admin'}"
                        th:onclick="'window.location.href=\'/vacancies/' + ${vacancy.id} + '/candidates\''"
                        class="view-candidates-button">
                    View Candidates
                </button>

                <!-- Доступно для всех, кроме админа -->
                <button th:if="${staffMember.position.toLowerCase() != 'admin'}"
                        class="apply-button"
                        onclick="applyToVacancy()">
                    Apply
                </button>




                <hr/>
            </div>
        </li>
    </ul>
</div>
</body>
<script>
    // Обработчик для кнопки "Apply"
    function applyToVacancy() {
        alert("Ваше резюме будет рассмотрено.");
    }

    // Обработчик для кнопки "Delete"
    function deleteVacancy(vacancyId) {
        if (confirm("Are you sure you want to delete this vacancy?")) {
            fetch(`/vacancies/${vacancyId}/close`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("Vacancy successfully closed!");
                        location.reload();
                    } else {
                        alert("Failed to close vacancy.");
                    }
                });
        }
    }

    function openCreateVacancyModal() {
        window.location.href = "/vacancies/new";
    }

    function viewCandidates(vacancyId) {
        window.location.href = `/vacancies/${vacancyId}/candidates`;
    }
    // Функция для возврата на предыдущую страницу
    function goBack() {
        window.history.back();
    }

</script>
</html>
